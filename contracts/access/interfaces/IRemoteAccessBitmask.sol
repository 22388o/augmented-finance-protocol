// SPDX-License-Identifier: agpl-3.0
pragma solidity 0.6.12;

import {BitUtils} from '../../tools/math/BitUtils.sol';

interface IRemoteAccessBitmask {
  /// @notice Returns access flags granted to the given address and limited by the filterMask.
  /// @dev Zero value of filterMask has a special meaning.
  /// @param addr a parameter just like in doxygen (must be followed by parameter name)
  /// @param filterMask limits a subset of flags to be checked.
  ///        When filterMask is zero, the function will return zero if no flags granted, or an unspecified non zero value otherwise.
  /// @return Access flags currently granted
  function queryAccessControlMask(address addr, uint256 filterMask) external view returns (uint256);
}

/**
 * @title RemoteAccessBitmaskHelper
 * @dev Wrapper around IRemoteAccessBitmask
 */
library RemoteAccessBitmaskHelper {
  using BitUtils for uint256;

  function getAcl(IRemoteAccessBitmask remote, address subject) internal view returns (uint256) {
    return remote.queryAccessControlMask(subject, ~uint256(0));
  }

  function queryAcl(
    IRemoteAccessBitmask remote,
    address subject,
    uint256 filterMask
  ) internal view returns (uint256) {
    return remote.queryAccessControlMask(subject, filterMask);
  }

  function hasAnyOf(
    IRemoteAccessBitmask remote,
    address subject,
    uint256 flags
  ) internal view returns (bool) {
    return queryAcl(remote, subject, flags).hasAnyOf(flags);
  }

  function hasAllOf(
    IRemoteAccessBitmask remote,
    address subject,
    uint256 flags
  ) internal view returns (bool) {
    return queryAcl(remote, subject, flags).hasAllOf(flags);
  }

  function hasNoneOf(
    IRemoteAccessBitmask remote,
    address subject,
    uint256 flags
  ) internal view returns (bool) {
    return queryAcl(remote, subject, flags).hasNoneOf(flags);
  }

  function hasAny(IRemoteAccessBitmask remote, address subject) internal view returns (bool) {
    return remote.queryAccessControlMask(subject, 0) != 0;
  }

  function hasNone(IRemoteAccessBitmask remote, address subject) internal view returns (bool) {
    return remote.queryAccessControlMask(subject, 0) == 0;
  }
}
